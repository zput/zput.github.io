<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>程序需要考虑的资源消耗问题 - Zput's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="zput"><meta name=description content="What do the terms “CPU bound” and “I/O bound” mean? 处理器更优先于调度I/O消耗型进程？ cpu中断 系统服务（这里不局限于golang写的后台"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.101.0 with theme even"><link rel=canonical href=http://zput.github.io/post/_posts/%E7%A8%8B%E5%BA%8F%E4%B8%8E%E6%B6%88%E8%80%97/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.fdb1035139209ff03fa34c28400ff54f04900828b7cafe0d2cfb1f48b70a2ffd.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="程序需要考虑的资源消耗问题"><meta property="og:description" content="What do the terms “CPU bound” and “I/O bound” mean? 处理器更优先于调度I/O消耗型进程？ cpu中断 系统服务（这里不局限于golang写的后台"><meta property="og:type" content="article"><meta property="og:url" content="http://zput.github.io/post/_posts/%E7%A8%8B%E5%BA%8F%E4%B8%8E%E6%B6%88%E8%80%97/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-06-22T19:00:00+00:00"><meta property="article:modified_time" content="2019-06-22T19:00:00+00:00"><meta itemprop=name content="程序需要考虑的资源消耗问题"><meta itemprop=description content="What do the terms “CPU bound” and “I/O bound” mean? 处理器更优先于调度I/O消耗型进程？ cpu中断 系统服务（这里不局限于golang写的后台"><meta itemprop=datePublished content="2019-06-22T19:00:00+00:00"><meta itemprop=dateModified content="2019-06-22T19:00:00+00:00"><meta itemprop=wordCount content="1399"><meta itemprop=keywords content="linux,cpu-memory-io,"><meta name=twitter:card content="summary"><meta name=twitter:title content="程序需要考虑的资源消耗问题"><meta name=twitter:description content="What do the terms “CPU bound” and “I/O bound” mean? 处理器更优先于调度I/O消耗型进程？ cpu中断 系统服务（这里不局限于golang写的后台"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Zput</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/go-goroutine><li class=mobile-menu-item>go源码专栏</li></a><a href=/post/mrmk/><li class=mobile-menu-item>中间件专栏</li></a><a href=/middleware/><li class=mobile-menu-item>云原生专栏</li></a><a href=/post/postgraduate/><li class=mobile-menu-item>考研专栏</li></a><a href=/post/><li class=mobile-menu-item>时间线</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Zput</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/go-goroutine>go源码专栏</a></li><li class=menu-item><a class=menu-item-link href=/post/mrmk/>中间件专栏</a></li><li class=menu-item><a class=menu-item-link href=/middleware/>云原生专栏</a></li><li class=menu-item><a class=menu-item-link href=/post/postgraduate/>考研专栏</a></li><li class=menu-item><a class=menu-item-link href=/post/>时间线</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>程序需要考虑的资源消耗问题</h1><div class=post-meta><span class=post-time>2019-06-22</span><div class=post-category><a href=/categories/systemandprotocol/>systemAndProtocol</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#what-do-the-terms-cpu-bound-and-io-bound-mean>What do the terms “CPU bound” and “I/O bound” mean?</a><ul><li></li></ul></li><li><a href=#系统服务这里不局限于golang写的后台服务也包括cjava等后台语言需要考虑的两个问题>系统服务（这里不局限于golang写的后台服务，也包括c++,java等后台语言）需要考虑的两个问题</a></li></ul></li></ul></nav></div></div><div class=article-container><div class=post-content><ul><li><a href=#what-do-the-terms-cpu-bound-and-io-bound-mean>What do the terms “CPU bound” and “I/O bound” mean?</a><ul><li><a href=#%E5%A4%84%E7%90%86%E5%99%A8%E6%9B%B4%E4%BC%98%E5%85%88%E4%BA%8E%E8%B0%83%E5%BA%A6io%E6%B6%88%E8%80%97%E5%9E%8B%E8%BF%9B%E7%A8%8B>处理器更优先于调度I/O消耗型进程？</a></li><li><a href=#cpu%E4%B8%AD%E6%96%AD>cpu中断</a></li></ul></li><li><a href=#%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E8%BF%99%E9%87%8C%E4%B8%8D%E5%B1%80%E9%99%90%E4%BA%8Egolang%E5%86%99%E7%9A%84%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E4%B9%9F%E5%8C%85%E6%8B%ACcjava%E7%AD%89%E5%90%8E%E5%8F%B0%E8%AF%AD%E8%A8%80%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98>系统服务（这里不局限于golang写的后台服务，也包括c++,java等后台语言）需要考虑的两个问题</a></li></ul><h2 id=what-do-the-terms-cpu-bound-and-io-bound-mean>What do the terms “CPU bound” and “I/O bound” mean?</h2><ul><li>CPU bound</li><li>I/O bound<ul><li>disk</li><li>networking</li><li>communication</li></ul></li></ul><p>It&rsquo;s pretty intuitive:</p><p>A program is <strong>CPU bound</strong> if it would go faster if the CPU were faster, i.e. it spends the majority of its time simply using the CPU (doing calculations). A program that computes new digits of π will typically be CPU-bound, it&rsquo;s just crunching numbers.</p><p>A program is <strong>I/O bound</strong> if it would go faster if the I/O subsystem was faster. Which exact I/O system is meant can vary; I typically associate it with <strong>disk</strong>, but of course <strong>networking</strong> or <strong>communication</strong> in general is common too. A program that looks through a huge file for some data might become I/O bound, since the bottleneck is then the reading of the data from disk (actually, this example is perhaps kind of old-fashioned these days with hundreds of MB/s coming in from SSDs).</p><p><a href=https://stackoverflow.com/questions/868568/what-do-the-terms-cpu-bound-and-i-o-bound-mean#>stackoverflow</a>
<a href=https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/6_CPU_Scheduling.html>CPU Scheduling</a></p><h4 id=处理器更优先于调度io消耗型进程>处理器更优先于调度I/O消耗型进程？</h4><blockquote><p><a href=http://book.51cto.com/art/201102/246235>reference</a>
这篇文字的最后一段说处理器更倾向于优先调度I/O消耗型的进程，因为是为了程序能够及时响应用户的交互。
但是I/O消耗型的进程在等待用户的输入时，难道不是被阻塞吗？ 等用户输入时才发生中断，然后被唤醒处理用户输入？</p></blockquote><blockquote><blockquote><p>个人理解。Linux 有个CFS 完全公平调度算法，大意是说，调度两个进程时，根据进程实际已经使用的<strong>cpu 时间占总时间的比例</strong>来判断，对于io消耗型进程执行时间越长，其对应比例越高，处理器消耗型进程相对很容易抢占执行，之后执行很短时间就结束，使得处理器消耗性响应速度很快</p></blockquote></blockquote><h4 id=cpu中断>cpu中断</h4><p>linux中，cpu主要用于中断、内核和用户进程的任务处理，优先级为中断>内核>用户进程，下面先讲述三个重要的概念。</p><blockquote><p>上下文切换</p><blockquote><p>每个cpu（多核cpu中的每个cpu）在同一时间只能执行一个线程，linux采用的是抢占式调度。为每个线程分配一定的执行时间， 当到达执行时间、线程中有io阻塞或高优先级的线程要执行时，linux将切换执行的线程，在切换时要存储目前的线程的执行状态， 并恢复要执行的线程的状态，这个过程就是上下文切换。对于java应用而言，典型的是在进行文件io操作、网络io操作、锁等待或者线程sleep时， 当前线程会进入阻塞或休眠状态，从而触发上下文切换，上下文切换过多会造成内核占据较多的cpu使用，从而使应用响应速度变慢。</p></blockquote></blockquote><blockquote><p>运行队列</p><blockquote><p>每个cpu核都会维护一个可运行的线程队列，例如一个4核的cpu，java应用里启动了8个线程，且这8个线程都处于可运行状态， 那么在分配平均的情况下每个cpu中的运行队列就会有2个线程。通常而言，系统的load主要由cpu运行队列来决定。</p></blockquote></blockquote><h2 id=系统服务这里不局限于golang写的后台服务也包括cjava等后台语言需要考虑的两个问题>系统服务（这里不局限于golang写的后台服务，也包括c++,java等后台语言）需要考虑的两个问题</h2><ol><li><p>系统的资源使用情况</p><ul><li>(cpu利用率，内存分配情况等，runtime和syscall都提供了支持，这个是系统内部性质，往往是设计系统资源问题，需要在设计的时候慎重考虑)</li></ul></li><li><p>系统的服务情况</p><ul><li>(就是服务时延，这个是client可以直接感知的，往往是client最关注的，决定了服务的qps)</li></ul></li></ol><blockquote><p>提前评估系统的资源消耗是很重要的，在公司里面，能提供选择的机器类型是很多种的。</p><blockquote><ul><li>比如腾讯，往往动则上亿qq号的量，很多时候需要在<strong>内存中cache用户的实时信息</strong>，如果内存评估不对，后面如果要进行机器迁移，则比较麻烦。</li></ul></blockquote></blockquote><blockquote><blockquote><ul><li>另外，cpu的数目太少，<strong>则并发性弱</strong>，影响服务的性能，特别是在一台机器上部署了多个服务后，抢cpu，抢内存的情况则格外严重，并且，如果把<strong>io密集程序跟cpu密集程序</strong>放到一起，<strong>io密集程序还可能会把耗内存的cpu程序</strong>给挤到swap中去导致服务出现间歇性的大量失败。</li></ul></blockquote></blockquote></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>zput</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2019-06-22</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/linux/>linux</a>
<a href=/tags/cpu-memory-io/>cpu-memory-io</a></div><nav class=post-nav><a class=prev href=/post/_posts/thread/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">谈谈线程</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/_posts/close_shutdown/><span class="next-text nav-default">Linux的socket相关函数调用时系统做了什么</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://giscus.app/client.js data-repo=zput/utterances-comments data-repo-id=R_kgDOHhATGQ data-category=Announcements data-category-id=DIC_kwDOHhATGc4CPxca data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:wkzxc@sina.com class="iconfont icon-email" title=email></a>
<a href=https://github.com/zput class="iconfont icon-github" title=github></a>
<a href=http://zput.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=copyright-year>&copy;
2017 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>zput</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script></body></html>