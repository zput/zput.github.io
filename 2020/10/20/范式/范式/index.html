<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="coding"><title>三种编程范式 | xczhao</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">三种编程范式</h1><a id="logo" href="/.">xczhao</a><p class="description">堆排序</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa igloo"> 首页</i></a><a href="/go-goroutine"><i class="fa duck"> Go-goroutine 设计与实现</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">三种编程范式</h1><div class="post-meta">2020-10-20<span> | </span><span class="category"><a href="/categories/%E8%8C%83%E5%BC%8F/">范式</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B"><span class="toc-text">泛型编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#golang"><span class="toc-text">golang</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B"><span class="toc-text">函数编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#golang-1"><span class="toc-text">golang</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%AE%97%E7%9A%84%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A6%82%E5%BF%B5%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">正宗的函数编程的概念是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E7%94%A8golang%E5%AE%9E%E7%8E%B0%E6%AD%A3%E5%AE%97%E7%9A%84%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E6%A6%82%E5%BF%B5%EF%BC%8C%E9%82%A3%E4%B9%88%E4%BC%9A%E5%8F%98%E6%88%90%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%3F"><span class="toc-text">如果用golang实现正宗的函数编程概念，那么会变成什么样子?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#map%E3%80%81reduce-%E5%92%8C-filter"><span class="toc-text">Map、Reduce 和 Filter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#decorated-function"><span class="toc-text">decorated function</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#add-print-content"><span class="toc-text">add print content</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#lazy-evalutions"><span class="toc-text">lazy evalutions</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#http-server"><span class="toc-text">http server</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%B0%E6%9C%89%E7%9A%84golang%E6%94%AF%E6%8C%81%E7%9A%84%E6%B3%9B%E5%9E%8B"><span class="toc-text">现有的golang支持的泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#interface-type"><span class="toc-text">interface type</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#reflect(relation-between-reflect-and-interface-type)"><span class="toc-text">reflect(relation between reflect and interface type)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%8A%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A6%82%E5%BF%B5%E6%89%A9%E5%A4%A7%E4%B8%80%E4%BA%9B%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0(%E7%AC%AC%E4%B8%80%E5%85%AC%E6%B0%91)%2C%E5%B0%B1%E6%8A%8A%E5%AE%83%E5%8F%AB%E5%81%9A%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B"><span class="toc-text">把函数编程的概念扩大一些：如果函数可以作为参数(第一公民),就把它叫做函数编程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%AD%E5%8C%85%E5%87%BD%E6%95%B0"><span class="toc-text">闭包函数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#example%3Adotake()"><span class="toc-text">example:DoTake()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#example%3Afunction-option"><span class="toc-text">example:function Option</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lazy-evaluations"><span class="toc-text">lazy evaluations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#visitor-model"><span class="toc-text">visitor model</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-text">面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#the-underlying-logic"><span class="toc-text">the underlying logic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B"><span class="toc-text">原型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delegation%2Fembed"><span class="toc-text">delegation&#x2F;embed</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#go"><span class="toc-text">go</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#delegation-%2B-polymorphism"><span class="toc-text">delegation + Polymorphism</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ioc"><span class="toc-text">IoC</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#step-one"><span class="toc-text">step one</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#step-two"><span class="toc-text">step two</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#interface-patterns"><span class="toc-text">Interface patterns</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#go-1"><span class="toc-text">go</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#example"><span class="toc-text">example</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a></li></ol></div></div><div class="post-content"><p>从编程范式入手</p>
<p>对于golang来说就是</p>
<h2 id="%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B" id="泛型编程">泛型编程</h2>
<h4 id="golang" id="golang">golang</h4>
<p>interface{}--&gt;interface{}/type XXX interface{YYY}<br />
reflect</p>
<h2 id="%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B" id="函数编程">函数编程</h2>
<h3 id="golang-1" id="golang-v2">golang</h3>
<p>仅当一个函数将一个或多个函数作为参数或作为结果返回另一个函数时，才可以将其视为高阶函数。</p>
<h4 id="%E6%AD%A3%E5%AE%97%E7%9A%84%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A6%82%E5%BF%B5%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" id="正宗的函数编程的概念是什么？">正宗的函数编程的概念是什么？</h4>
<ul>
<li>stateless：函数不维护任何状态。函数式编程的核心精神是stateless，简而言之就是它不能存在状态，打个比方，你给我数据我处理完扔出来。里面的数据是不变的。</li>
<li>immutable：输入数据是不能动的，动了输入数据就有危险，所以要返回新的数据集。</li>
</ul>
<blockquote>
<p>劣势:</p>
<blockquote>
<p>数据复制比较严重。</p>
<blockquote>
<p>注：有一些人可能会觉得这会对性能造成影响。其实，这个劣势不见得会导致性能不好。因为没有状态，所以代码在并行上根本不需要锁（不需要对状态修改的锁），所以可以拼命地并发，反而可以让性能很不错。比如：Erlang 就是其中的代表。<a href="https://time.geekbang.org/column/article/107560">reference</a></p>
</blockquote>
</blockquote>
</blockquote>
<p>函数式语言有三套件，Map、Reduce 和 Filter。</p>
<h4 id="%E5%A6%82%E6%9E%9C%E7%94%A8golang%E5%AE%9E%E7%8E%B0%E6%AD%A3%E5%AE%97%E7%9A%84%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E6%A6%82%E5%BF%B5%EF%BC%8C%E9%82%A3%E4%B9%88%E4%BC%9A%E5%8F%98%E6%88%90%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%3F" id="如果用golang实现正宗的函数编程概念，那么会变成什么样子">如果用golang实现正宗的函数编程概念，那么会变成什么样子?</h4>
<blockquote>
<p>Functional programming examples in Go</p>
</blockquote>
<ol>
<li>Updating a string</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"> name := <span class="string">"first name"</span></span><br><span class="line"> name := name + <span class="string">" last name"</span></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"> firstname := <span class="string">"first"</span></span><br><span class="line"> lastname := <span class="string">"last"</span></span><br><span class="line"> fullname := firstname + <span class="string">" "</span> + lastname</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Avoid updating arrays</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">names := [<span class="number">3</span>]<span class="keyword">string</span>&#123;<span class="string">"Tom"</span>, <span class="string">"Ben"</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add Lucas to the array</span></span><br><span class="line">    names[<span class="number">2</span>] = <span class="string">"Lucas"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line">    names := []<span class="keyword">string</span>&#123;<span class="string">"Tom"</span>, <span class="string">"Ben"</span>&#125;</span><br><span class="line">    allNames := <span class="built_in">append</span>(names, <span class="string">"Lucas"</span>)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Avoid updating maps</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fruits := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"bananas"</span>: <span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Buy five apples</span></span><br><span class="line">    fruits[<span class="string">"apples"</span>] = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line">    fruits := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"bananas"</span>: <span class="number">11</span>&#125;</span><br><span class="line">    newFruits := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"apples"</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    allFruits := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>, <span class="built_in">len</span>(fruits) + <span class="built_in">len</span>(newFruits))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> fruits &#123;</span><br><span class="line">        allFruits[k] = v</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> newFruits &#123;</span><br><span class="line">        allFruits[k] = v</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Higher-order functions and currying</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Create more variations</span></span><br><span class="line">    add10 := add(<span class="number">10</span>)</span><br><span class="line">    add20 := add(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Currying</span></span><br><span class="line">    fmt.Println(add10(<span class="number">1</span>)) <span class="comment">// 11</span></span><br><span class="line">    fmt.Println(add20(<span class="number">1</span>)) <span class="comment">// 21</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>Recursion</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">factorial</span><span class="params">(fac <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    result := <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> ; fac &gt; <span class="number">0</span>; fac-- &#123;</span><br><span class="line">        result *= fac</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateFactorial</span><span class="params">(fac <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> fac == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fac * calculateFactorial(fac - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="map%E3%80%81reduce-%E5%92%8C-filter" id="Map、Reduce-和-Filter">Map、Reduce 和 Filter</h5>
<p>因为没有泛型，<br />
所以类型不能泛型，容器不能泛型，算法不能泛型。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">Iter</span>, <span class="title">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Op</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">T</span> <span class="title">reduce</span> (<span class="title">Iter</span> <span class="title">start</span>, <span class="title">Iter</span> <span class="title">end</span>, <span class="title">T</span> <span class="title">init</span>, <span class="title">Op</span> <span class="title">op</span>) &#123;</span></span><br><span class="line">  T result = init;</span><br><span class="line">  <span class="keyword">while</span> ( start != <span class="built_in">end</span> ) &#123;</span><br><span class="line">    result = op( result, *start );</span><br><span class="line">    start++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/yanatan16/itertools">使用这个工具</a></p>
<ul>
<li>Map</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">mapper := <span class="function"><span class="keyword">func</span> <span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> strings.ToUpper(i.(<span class="keyword">string</span>))</span><br><span class="line">&#125;</span><br><span class="line">Map(mapper, New(“milu”, “rantanplan”))</span><br><span class="line"><span class="comment">//[“MILU”, “RANTANPLAN”]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Filter</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">pred := <span class="function"><span class="keyword">func</span> <span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> i.(<span class="keyword">uint64</span>) &gt; <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">Filter(pred, Uint64(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>))</span><br><span class="line"><span class="comment">//[6, 7, 8, 9, 10]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Reduce</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">acumullator := <span class="function"><span class="keyword">func</span> <span class="params">(memo <span class="keyword">interface</span>&#123;&#125;, el <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(memo.(<span class="keyword">string</span>)) + <span class="built_in">len</span>(el.(<span class="keyword">string</span>))</span><br><span class="line">&#125;</span><br><span class="line">Reduce(New(“milu”, “rantanplan”), acumullator, <span class="keyword">string</span>).(<span class="keyword">uint64</span>)</span><br><span class="line"><span class="comment">// result 14</span></span><br></pre></td></tr></table></figure>
<h5 id="decorated-function" id="decorated-function">decorated function</h5>
<h6 id="add-print-content" id="add-print-content">add print content</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decorator</span><span class="params">(f <span class="keyword">func</span>(s <span class="keyword">string</span>)</span>) <span class="title">func</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Started"</span>)</span><br><span class="line">		f(s)</span><br><span class="line">		fmt.Println(<span class="string">"Done"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	decorator(Hello)(<span class="string">"Hello, World!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="lazy-evalutions" id="lazy-evalutions">lazy evalutions</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SumFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int64</span>, <span class="keyword">int64</span>)</span> <span class="title">int64</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFunctionName</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> runtime.FuncForPC(reflect.ValueOf(i).Pointer()).Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timedSumFunc</span><span class="params">(f SumFunc)</span> <span class="title">SumFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(start, end <span class="keyword">int64</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(t time.Time)</span></span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"--- Time Elapsed (%s): %v ---\n"</span>,</span><br><span class="line">				getFunctionName(f), time.Since(t))</span><br><span class="line">		&#125;(time.Now())</span><br><span class="line">		<span class="keyword">return</span> f(start, end)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum1</span><span class="params">(start, end <span class="keyword">int64</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> sum <span class="keyword">int64</span></span><br><span class="line">	sum = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> start &gt; end &#123;</span><br><span class="line">		start, end = end, start</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">		sum += i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum2</span><span class="params">(start, end <span class="keyword">int64</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> start &gt; end &#123;</span><br><span class="line">		start, end = end, start</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (end - start + <span class="number">1</span>) * (end + start) / <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sum1 := timedSumFunc(Sum1)</span><br><span class="line">	sum2 := timedSumFunc(Sum2)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"%d, %d\n"</span>, sum1(<span class="number">-10000</span>, <span class="number">10000000</span>), sum2(<span class="number">-10000</span>, <span class="number">10000000</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="http-server" id="http-server">http server</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"reflect"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithServerHeader</span><span class="params">(h http.HandlerFunc)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">"---&gt;WithServerHeader()"</span>)</span><br><span class="line">		w.Header().Set(<span class="string">"Server"</span>, <span class="string">"HelloServer v0.0.1"</span>)</span><br><span class="line">		h(w, r)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithAuthCookie</span><span class="params">(h http.HandlerFunc)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">"---&gt;WithAuthCookie()"</span>)</span><br><span class="line">		cookie := &amp;http.Cookie&#123;Name: <span class="string">"Auth"</span>, Value: <span class="string">"Pass"</span>, Path: <span class="string">"/"</span>&#125;</span><br><span class="line">		http.SetCookie(w, cookie)</span><br><span class="line">		h(w, r)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithBasicAuth</span><span class="params">(h http.HandlerFunc)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">"---&gt;WithBasicAuth()"</span>)</span><br><span class="line">		cookie, err := r.Cookie(<span class="string">"Auth"</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> || cookie.Value != <span class="string">"Pass"</span> &#123;</span><br><span class="line">			w.WriteHeader(http.StatusForbidden)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		h(w, r)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDebugLog</span><span class="params">(h http.HandlerFunc)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">"---&gt;WithDebugLog"</span>)</span><br><span class="line">		r.ParseForm()</span><br><span class="line">		log.Println(r.Form)</span><br><span class="line">		log.Println(<span class="string">"path"</span>, r.URL.Path)</span><br><span class="line">		log.Println(<span class="string">"scheme"</span>, r.URL.Scheme)</span><br><span class="line">		log.Println(r.Form[<span class="string">"url_long"</span>])</span><br><span class="line">		<span class="keyword">for</span> k, v := <span class="keyword">range</span> r.Form &#123;</span><br><span class="line">			log.Println(<span class="string">"key:"</span>, k)</span><br><span class="line">			log.Println(<span class="string">"val:"</span>, strings.Join(v, <span class="string">""</span>))</span><br><span class="line">		&#125;</span><br><span class="line">		h(w, r)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	log.Printf(<span class="string">"Received Request %s from %s\n"</span>, r.URL.Path, r.RemoteAddr)</span><br><span class="line">	fmt.Fprintf(w, <span class="string">"Hello, World! "</span>+r.URL.Path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">example1</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">"/v1/hello"</span>, WithServerHeader(WithAuthCookie(hello)))</span><br><span class="line">	http.HandleFunc(<span class="string">"/v2/hello"</span>, WithServerHeader(WithBasicAuth(hello)))</span><br><span class="line">	http.HandleFunc(<span class="string">"/v3/hello"</span>, WithServerHeader(WithBasicAuth(WithDebugLog(hello))))</span><br><span class="line"></span><br><span class="line">	http.HandleFunc(<span class="string">"/v4/hello"</span>, Handler(hello, WithServerHeader, WithBasicAuth, WithDebugLog))</span><br><span class="line">	err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">"ListenAndServe: "</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HttpHandlerDecorator <span class="function"><span class="keyword">func</span><span class="params">(http.HandlerFunc)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Handler</span><span class="params">(h http.HandlerFunc, decors ...HttpHandlerDecorator)</span> <span class="title">http</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> decors &#123;</span><br><span class="line">		d := decors[<span class="built_in">len</span>(decors)<span class="number">-1</span>-i] <span class="comment">// iterate in reverse</span></span><br><span class="line">		h = d(h)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	example3()</span><br><span class="line">	<span class="comment">//example2()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//example1()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">example3</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	mybar := bar</span><br><span class="line">	Decorator(&amp;mybar, bar)</span><br><span class="line">	mybar(<span class="string">"hello,"</span>, <span class="string">"world!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">example2</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">type</span> MyFoo <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">	<span class="keyword">var</span> myfoo MyFoo</span><br><span class="line">	Decorator(&amp;myfoo, foo)</span><br><span class="line">	myfoo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(a, b, c <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%d, %d, %d \n"</span>, a, b, c)</span><br><span class="line">	<span class="keyword">return</span> a + b + c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">(a, b <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%s, %s \n"</span>, a, b)</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decorator</span><span class="params">(decoPtr, fn <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> decoratedFunc, targetFunc reflect.Value</span><br><span class="line"></span><br><span class="line">	decoratedFunc = reflect.ValueOf(decoPtr).Elem()</span><br><span class="line">	targetFunc = reflect.ValueOf(fn)</span><br><span class="line"></span><br><span class="line">	v := reflect.MakeFunc(targetFunc.Type(),</span><br><span class="line">		<span class="function"><span class="keyword">func</span><span class="params">(in []reflect.Value)</span> <span class="params">(out []reflect.Value)</span></span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"before"</span>)</span><br><span class="line">			out = targetFunc.Call(in)</span><br><span class="line">			fmt.Println(<span class="string">"after"</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	decoratedFunc.Set(v)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="%E7%8E%B0%E6%9C%89%E7%9A%84golang%E6%94%AF%E6%8C%81%E7%9A%84%E6%B3%9B%E5%9E%8B" id="现有的golang支持的泛型">现有的golang支持的泛型</h5>
<blockquote>
<p>type InterfaceType interface; interface{}; reflect;</p>
</blockquote>
<h6 id="interface-type" id="interface-type">interface type</h6>
<ul>
<li>what is interface type?
<ul>
<li>concept: type and interface
<ul>
<li>interface types, which represent fixed sets of methods. An interface variable can store any concrete (non-interface) value as long as that value implements the interface's methods.</li>
</ul>
</li>
<li>the representation of an interface
<ul>
<li><a href="https://research.swtch.com/interfaces">Go Data Structures: Interfaces</a></li>
<li>A variable of interface type stores a pair:
<ul>
<li>the value is the underlying concrete data item that implements the interface</li>
<li>the type describes the full type of that item</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> r io.Reader</span><br><span class="line">tty, err := os.OpenFile(<span class="string">"/dev/tty"</span>, os.O_RDWR, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">r = tty</span><br></pre></td></tr></table></figure>
<p>//r contains, schematically, the <strong>(value, type) pair</strong>, <code>(tty, *os.File)</code>.</p>
<h6 id="reflect(relation-between-reflect-and-interface-type)" id="reflect-relation-between-reflect-and-interface-type">reflect(relation between reflect and interface type)</h6>
<blockquote>
<p>the relation between reflect and interface type</p>
</blockquote>
<ul>
<li>the laws of reflection:
<ul>
<li>Reflection goes from interface value to reflection object.</li>
<li>Reflection goes from reflection object to interface value.</li>
<li>To modify a reflection object, the value must be settable.</li>
</ul>
</li>
</ul>
<ol>
<li>Reflection goes from interface value to reflection object.</li>
</ol>
<ul>
<li>
<p>give access to the contents of an interface variable</p>
<ul>
<li>two type
<ul>
<li><a href="https://golang.org/pkg/reflect/#Type">Type</a></li>
<li><a href="https://golang.org/pkg/reflect/#Value">Value</a></li>
</ul>
</li>
<li>two function to retrieve reflect.Type and reflect.Value(Two type) from interface variable
<ul>
<li>reflect.TypeOf</li>
<li>reflect.ValueOf</li>
</ul>
</li>
</ul>
</li>
<li>
<p>singling out</p>
<ul>
<li>first: to keep the API simple, the &quot;getter&quot; and &quot;setter&quot; methods of Value operate on the largest type that can hold the value: int64 for all the signed integers</li>
<li>second: the Kind of a reflection object describes the underlying type, not the static type. If a reflection object contains a value of a user-defined integer type</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">uint8</span> = <span class="string">'x'</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">fmt.Println(<span class="string">"type:"</span>, v.Type())                            <span class="comment">// uint8.</span></span><br><span class="line">fmt.Println(<span class="string">"kind is uint8: "</span>, v.Kind() == reflect.Uint8) <span class="comment">// true.</span></span><br><span class="line">x = <span class="keyword">uint8</span>(v.Uint())                                       <span class="comment">// v.Uint returns a uint64.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> x MyInt = <span class="number">7</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Reflection goes from reflection object to interface value.</li>
</ol>
<ul>
<li>from reflect.Value to interface value
<ul>
<li><code>func (v Value) Interface() interface{}</code></li>
</ul>
</li>
</ul>
<ol start="3">
<li>To modify a reflection object, the value must be settable.</li>
</ol>
<ul>
<li>Settability is a property of a reflection Value, and not all reflection Values have it.
<ul>
<li>The CanSet method of Value reports the settability of a Value.</li>
<li>Settability
<ul>
<li>Settability is determined by whether the reflection object holds the original item</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.4</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">v.SetFloat(<span class="number">7.1</span>) <span class="comment">// Error: will panic.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">3.4</span></span><br><span class="line">p := reflect.ValueOf(&amp;x) <span class="comment">// Note: take the address of x.</span></span><br><span class="line">fmt.Println(<span class="string">"type of p:"</span>, p.Type())<span class="comment">// type of p: *float64</span></span><br><span class="line">fmt.Println(<span class="string">"settability of p:"</span>, p.CanSet())<span class="comment">// settability of p: false</span></span><br><span class="line"></span><br><span class="line">v := p.Elem()</span><br><span class="line">fmt.Println(<span class="string">"settability of v:"</span>, v.CanSet())<span class="comment">// settability of v: true</span></span><br><span class="line"></span><br><span class="line">v.SetFloat(<span class="number">7.1</span>)</span><br><span class="line">fmt.Println(v.Interface())<span class="comment">// 7.1</span></span><br><span class="line">fmt.Println(x)<span class="comment">// 7.1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>struct</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectStruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println()</span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">		A <span class="keyword">int</span></span><br><span class="line">		B <span class="keyword">string</span></span><br><span class="line">	&#125;</span><br><span class="line">	t := T&#123;<span class="number">23</span>, <span class="string">"skidoo"</span>&#125;</span><br><span class="line">	s := reflect.ValueOf(t)	<span class="comment">//&amp;t).Elem()</span></span><br><span class="line">	typeOfT := s.Type()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; s.NumField(); i++ &#123;</span><br><span class="line">		f := s.Field(i)</span><br><span class="line">		fmt.Printf(<span class="string">"%d: %s %s = %v\n"</span>, i,</span><br><span class="line">			typeOfT.Field(i).Name, f.Type(), f.Interface())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; typeOfT.NumField(); i++ &#123;</span><br><span class="line">		f := s.Field(i)</span><br><span class="line">		fmt.Printf(<span class="string">"%d: %s %s = %v\n"</span>, i,</span><br><span class="line">			typeOfT.Field(i).Name, f.Type(), f.Interface())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sMutable := reflect.ValueOf(&amp;t).Elem()</span><br><span class="line">	sMutable.Field(<span class="number">0</span>).SetInt(<span class="number">77</span>)</span><br><span class="line">	sMutable.Field(<span class="number">1</span>).SetString(<span class="string">"Sunset Strip"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"t is now"</span>, t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%8A%8A%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A6%82%E5%BF%B5%E6%89%A9%E5%A4%A7%E4%B8%80%E4%BA%9B%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0(%E7%AC%AC%E4%B8%80%E5%85%AC%E6%B0%91)%2C%E5%B0%B1%E6%8A%8A%E5%AE%83%E5%8F%AB%E5%81%9A%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B" id="把函数编程的概念扩大一些：如果函数可以作为参数-第一公民-就把它叫做函数编程">把函数编程的概念扩大一些：如果函数可以作为参数(第一公民),就把它叫做函数编程</h4>
<h5 id="%E9%97%AD%E5%8C%85%E5%87%BD%E6%95%B0" id="闭包函数">闭包函数</h5>
<p>它的实际是:它允许将函数与其所操作的某些数据（环境）关联起来。这显然类似于面向对象编程(对象允许我们将某些数据（对象的属性）与一个或者多个方法相关联)--&gt;所以闭包函数可以看作，就是一个类(它只有一个方法)的对象的方法，</p>
<h6 id="example%3Adotake()" id="example-DoTake">example:DoTake()</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> tokenCallback <span class="function"><span class="keyword">func</span><span class="params">(pb.TokenServiceClient)</span> <span class="title">error</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mockToken pb.TokenServiceClient</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tokenDo</span><span class="params">(callback tokenCallback)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	client := mockToken</span><br><span class="line">	<span class="keyword">if</span> client == <span class="literal">nil</span> &#123;</span><br><span class="line">		conn, err := grpc.Dial(TokenAddr, grpc.WithInsecure())</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> fmt.Errorf(<span class="string">"Dial token service err: %v"</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">defer</span> conn.Close()</span><br><span class="line">		client = pb.NewTokenServiceClient(conn)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> callback(client)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCloser</span><span class="params">(source, appID, UID <span class="keyword">string</span>, expiry time.Duration, res *pb.Token, err error)</span>*<span class="title">Closer</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Closer&#123;</span><br><span class="line">		source:source,</span><br><span class="line">		appID:appID,</span><br><span class="line">		UID:UID,</span><br><span class="line">		expiry:expiry,</span><br><span class="line">		res:res,</span><br><span class="line">		err:err,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">struct</span>&#123;</span><br><span class="line">	source, appID, UID <span class="keyword">string</span>; expiry time.Duration</span><br><span class="line">	res *pb.Token; err error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(this *Closer)</span><span class="title">XXX</span><span class="params">(client pb.TokenServiceClient)</span><span class="params">(err error)</span></span>&#123;</span><br><span class="line">	this.res, err = client.Create(context.Background(), &amp;pb.CreateRequest&#123;</span><br><span class="line">		Subject:   fmt.Sprintf(<span class="string">"%s,%s"</span>, this.source, this.appID),</span><br><span class="line">		Uid:       this.UID,</span><br><span class="line">		ExpiredAt: &amp;timestamp.Timestamp&#123;Seconds: time.Now().Add(this.expiry).Unix(), Nanos: <span class="number">0</span>&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateToken</span><span class="params">(source, appID, UID <span class="keyword">string</span>, expiry time.Duration)</span> <span class="params">(res *pb.Token, err error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// first: using class member function</span></span><br><span class="line">	err = tokenDo(NewCloser(source, appID, UID, expiry, res, err).XXX)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// second: using closer</span></span><br><span class="line">	<span class="comment">/*err = tokenDo(func(client pb.TokenServiceClient) (err error) &#123;</span></span><br><span class="line"><span class="comment">	 	res, err = client.Create(context.Background(), &amp;pb.CreateRequest&#123;</span></span><br><span class="line"><span class="comment">	 		Subject:   fmt.Sprintf("%s,%s", source, appID),</span></span><br><span class="line"><span class="comment">	 		Uid:       UID,</span></span><br><span class="line"><span class="comment">	 		ExpiredAt: &amp;timestamp.Timestamp&#123;Seconds: time.Now().Add(expiry).Unix(), Nanos: 0&#125;,</span></span><br><span class="line"><span class="comment">	 	&#125;)</span></span><br><span class="line"><span class="comment">	 	return</span></span><br><span class="line"><span class="comment">	 &#125;)</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="example%3Afunction-option" id="example-function-Option">example:function Option</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"crypto/tls"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">	Addr <span class="keyword">string</span></span><br><span class="line">	Port <span class="keyword">int</span></span><br><span class="line">	Protocol <span class="keyword">string</span></span><br><span class="line">	Timeout time.Duration</span><br><span class="line">	MaxConns <span class="keyword">int</span></span><br><span class="line">	TLS *tls.Config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Option <span class="function"><span class="keyword">func</span><span class="params">(*Server)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Protocol</span><span class="params">(p <span class="keyword">string</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">		s.Protocol = p</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Timeout</span><span class="params">(timeout time.Duration)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">		s.Timeout = timeout</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MaxConns</span><span class="params">(maxconns <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">		s.MaxConns = maxconns</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TLS</span><span class="params">(tls *tls.Config)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">		s.TLS = tls</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(addr <span class="keyword">string</span>, port <span class="keyword">int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	options ...<span class="keyword">func</span>(*Server)</span>) <span class="params">(*Server, error)</span></span> &#123;</span><br><span class="line">	srv := Server&#123;</span><br><span class="line">		Addr: addr,</span><br><span class="line">		Port: port,</span><br><span class="line">		Protocol: <span class="string">"tcp"</span>,</span><br><span class="line">		Timeout: <span class="number">30</span> * time.Second,</span><br><span class="line">		MaxConns: <span class="number">1000</span>,</span><br><span class="line">		TLS: <span class="literal">nil</span>, &#125;</span><br><span class="line">	<span class="keyword">for</span> _, option := <span class="keyword">range</span> options &#123;</span><br><span class="line">		option(&amp;srv) &#125;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">	<span class="keyword">return</span> &amp;srv, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s1, _ := NewServer(<span class="string">"localhost"</span>, <span class="number">1024</span>)</span><br><span class="line">	s2, _ := NewServer(<span class="string">"localhost"</span>, <span class="number">2048</span>, Protocol(<span class="string">"udp"</span>))</span><br><span class="line">	s3, _ := NewServer(<span class="string">"0.0.0.0"</span>, <span class="number">8080</span>, Timeout(<span class="number">300</span>*time.Second), MaxConns(<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">	_ = s1</span><br><span class="line">	_ = s2</span><br><span class="line">	_ = s3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="lazy-evaluations" id="lazy-evaluations">lazy evaluations</h5>
<ul>
<li>示例:</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"executing add"</span>) <span class="comment">// this is printed since the functions are evaluated first</span></span><br><span class="line">	<span class="keyword">return</span> x + x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"executing multiply"</span>) <span class="comment">// this is printed since the functions are evaluated first</span></span><br><span class="line">	<span class="keyword">return</span> x * x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addOrMultiply</span><span class="params">(add <span class="keyword">bool</span>, onAdd, onMultiply <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> add &#123;</span><br><span class="line">		<span class="keyword">return</span> onAdd</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> onMultiply</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NotLazy</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(addOrMultiply(<span class="literal">true</span>, add(<span class="number">4</span>), multiply(<span class="number">4</span>)))  <span class="comment">// 8</span></span><br><span class="line">	fmt.Println(addOrMultiply(<span class="literal">false</span>, add(<span class="number">4</span>), multiply(<span class="number">4</span>))) <span class="comment">// 16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	NotLazy()</span><br><span class="line">	fmt.Println(<span class="string">"---"</span>)</span><br><span class="line">	Lazy()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Lazy</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(addOrMultiplyLazy(<span class="literal">true</span>, add, multiply, <span class="number">4</span>))</span><br><span class="line">	fmt.Println(addOrMultiplyLazy(<span class="literal">false</span>, add, multiply, <span class="number">4</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is now a higher-order-function hence evaluation of the functions are delayed in if-else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addOrMultiplyLazy</span><span class="params">(add <span class="keyword">bool</span>, onAdd, onMultiply <span class="keyword">func</span>(t <span class="keyword">int</span>)</span> <span class="title">int</span>, <span class="title">t</span> <span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> add &#123;</span><br><span class="line">		<span class="keyword">return</span> onAdd(t)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> onMultiply(t)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">executing add</span></span><br><span class="line"><span class="comment">executing multiply</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">executing add</span></span><br><span class="line"><span class="comment">executing multiply</span></span><br><span class="line"><span class="comment">16</span></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="comment">executing add</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">executing multiply</span></span><br><span class="line"><span class="comment">16</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h5 id="visitor-model" id="visitor-model">visitor model</h5>
<p><a href="https://zput.github.io/2020/11/24/%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/">visitor实战</a></p>
<h2 id="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B" id="面向对象编程">面向对象编程</h2>
<h3 id="the-underlying-logic" id="the-underlying-logic">the underlying logic</h3>
<ul>
<li>这本书的 23 个经典的设计模式，基本上就是说了两个面向对象的核心理念：
<ul>
<li>&quot;Program to an ‘interface’, not an ‘implementation’.&quot;
<ul>
<li>使用者不需要知道数据类型、结构、算法的细节。</li>
<li>使用者不需要知道实现细节，只需要知道提供的接口。</li>
<li>利于抽象、封装、动态绑定、多态。符合面向对象的特质和理念。</li>
</ul>
</li>
<li>&quot;Favor ‘object composition’ over ‘class inheritance’.&quot;
<ul>
<li>继承需要给子类暴露一些父类的设计和实现细节。</li>
<li>父类实现的改变会造成子类也需要改变。</li>
<li>我们以为继承主要是为了代码重用，但实际上在子类中需要重新实现很多父类的方法。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>代码需要通过对象来达到抽象的效果，导致了相当厚重的“代码粘合层”。<br />
通过对象来达到抽象结果，把代码分散在不同的类里面，然后，要让它们执行起来，就需要把这些类粘合起来。</p>
<h3 id="%E5%8E%9F%E5%9E%8B" id="原型">原型</h3>
<p>基于原型（Prototype）的编程其实也是面向对象编程的一种方式。没有 class 化的，直接使用对象。又叫，基于实例的编程</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Define human class</span></span><br><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span> (<span class="params">fullName, email</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.fullName = fullName;</span><br><span class="line">  <span class="keyword">this</span>.email = email;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"I speak English!"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.introduction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Hi, I am "</span> + <span class="keyword">this</span>.fullName);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Define Student class</span></span><br><span class="line"><span class="keyword">var</span> Student = <span class="function"><span class="keyword">function</span>(<span class="params">fullName, email, school, courses</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="keyword">this</span>, fullName, email);</span><br><span class="line">  <span class="comment">// Initialize our Student properties</span></span><br><span class="line">  <span class="keyword">this</span>.school = school;</span><br><span class="line">  <span class="keyword">this</span>.courses = courses;</span><br><span class="line">  <span class="comment">// override the "introduction" method</span></span><br><span class="line">  <span class="keyword">this</span>.introduction= <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Hi, I am "</span> + <span class="keyword">this</span>.fullName +</span><br><span class="line">        <span class="string">". I am a student of "</span> + <span class="keyword">this</span>.school +</span><br><span class="line">        <span class="string">", I study "</span>+ <span class="keyword">this</span>.courses +<span class="string">"."</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Add a "exams" method</span></span><br><span class="line">  <span class="keyword">this</span>.takeExams = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"This is my exams time!"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a Student.prototype object that inherits</span></span><br><span class="line"><span class="comment">// from Person.prototype.</span></span><br><span class="line">Student.prototype = <span class="built_in">Object</span>.create(Person.prototype);</span><br><span class="line"><span class="comment">// Set the "constructor" property to refer to Student</span></span><br><span class="line">Student.prototype.constructor = Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">"Hao Chen"</span>,</span><br><span class="line">              <span class="string">"haoel@hotmail.com"</span>,</span><br><span class="line">              <span class="string">"XYZ University"</span>,</span><br><span class="line">              <span class="string">"Computer Science"</span>);</span><br><span class="line">student.introduction();</span><br><span class="line">student.speak();</span><br><span class="line">student.takeExams();</span><br><span class="line"><span class="comment">// Check that instanceof works correctly</span></span><br><span class="line"><span class="built_in">console</span>.log(student <span class="keyword">instanceof</span> Person);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(student <span class="keyword">instanceof</span> Student); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>一种委托的方式。在使用委托的基于原型的语言中，运行时语言可以“仅仅通过序列的指针找到匹配”这样的方式来定位属性或者寻找正确的数据。所有这些创建行为、共享的行为需要的是委托指针;
<ul>
<li>这里就说明了委托的方式，跟golang的委托也差不多; 只不过一个是对象(实例)的委托，一个是类的委托。</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Widget <span class="keyword">struct</span> &#123;</span><br><span class="line">    X, Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Label <span class="keyword">struct</span> &#123;</span><br><span class="line">    Widget        <span class="comment">// Embedding (delegation)</span></span><br><span class="line">    Text   <span class="keyword">string</span> <span class="comment">// Aggregation</span></span><br><span class="line">    X <span class="keyword">int</span>         <span class="comment">// Override </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(label Label)</span> <span class="title">Paint</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// [0xc4200141e0] - Label.Paint("State")</span></span><br><span class="line">    fmt.Printf(<span class="string">"[%p] - Label.Paint(%q)\n"</span>, </span><br><span class="line">      &amp;label, label.Text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">由上面可知：</span></span><br><span class="line"><span class="comment">    我们声明了一个 Widget，其有 X和Y；</span></span><br><span class="line"><span class="comment">    然后用它来声明一个 Label，直接把 Widget 委托进去；</span></span><br><span class="line"><span class="comment">    然后再给 Label 声明并实现了一个 Paint() 方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<ul>
<li>原型编程看起来提倡程序员关注一系列<strong>对象实例</strong>的行为，而之后才关心如何将<strong>这些对象</strong>划分到<em>最近的使用方式</em>相似的原型对象，而不是分成类;
<ul>
<li>这个要打一个问号，好像没有把它们分成类。</li>
</ul>
</li>
</ul>
<h3 id="delegation%2Fembed" id="delegation-embed">delegation/embed</h3>
<h4 id="go" id="go">go</h4>
<ul>
<li>Go语中的委托和接口多态的编程方式，其实是:
<ul>
<li>面向对象和原型编程综合的玩法;</li>
</ul>
</li>
</ul>
<h5 id="delegation-%2B-polymorphism" id="delegation-Polymorphism">delegation + Polymorphism</h5>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Widget <span class="keyword">struct</span> &#123;</span><br><span class="line">	X, Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Label <span class="keyword">struct</span> &#123;</span><br><span class="line">	Widget        <span class="comment">// Embedding (delegation)</span></span><br><span class="line">	Text   <span class="keyword">string</span> <span class="comment">// Aggregation</span></span><br><span class="line">	X <span class="keyword">int</span>         <span class="comment">// Override</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(label Label)</span> <span class="title">Paint</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// [0xc4200141e0] - Label.Paint("State")</span></span><br><span class="line">	fmt.Printf(<span class="string">"[%p] - Label.Paint(%q)\n"</span>,</span><br><span class="line">		&amp;label, label.Text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Button <span class="keyword">struct</span> &#123;</span><br><span class="line">	Label <span class="comment">// Embedding (delegation)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewButton</span><span class="params">(x, y <span class="keyword">int</span>, text <span class="keyword">string</span>)</span> <span class="title">Button</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Button&#123;Label&#123;Widget&#123;x, y&#125;, text, x&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(button Button)</span> <span class="title">Paint</span><span class="params">()</span></span> &#123; <span class="comment">// Override</span></span><br><span class="line">	fmt.Printf(<span class="string">"[%p] - Button.Paint(%q)\n"</span>,</span><br><span class="line">		&amp;button, button.Text)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(button Button)</span> <span class="title">Click</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"[%p] - Button.Click()\n"</span>, &amp;button)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ListBox <span class="keyword">struct</span> &#123;</span><br><span class="line">	Widget          <span class="comment">// Embedding (delegation)</span></span><br><span class="line">	Texts  []<span class="keyword">string</span> <span class="comment">// Aggregation</span></span><br><span class="line">	Index  <span class="keyword">int</span>      <span class="comment">// Aggregation</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(listBox ListBox)</span> <span class="title">Paint</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"[%p] - ListBox.Paint(%q)\n"</span>,</span><br><span class="line">		&amp;listBox, listBox.Texts)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(listBox ListBox)</span> <span class="title">Click</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"[%p] - ListBox.Click()\n"</span>, &amp;listBox)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Painter <span class="keyword">interface</span> &#123;</span><br><span class="line">	Paint()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Clicker <span class="keyword">interface</span> &#123;</span><br><span class="line">	Click()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	label := Label&#123;Widget&#123;<span class="number">10</span>, <span class="number">10</span>&#125;, <span class="string">"State"</span>, <span class="number">100</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// X=100, Y=10, Text=State, Widget.X=10</span></span><br><span class="line">	fmt.Printf(<span class="string">"X=%d, Y=%d, Text=%s Widget.X=%d\n"</span>,</span><br><span class="line">		label.X, label.Y, label.Text,</span><br><span class="line">		label.Widget.X)</span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="comment">// &#123;Widget:&#123;X:10 Y:10&#125; Text:State X:100&#125;</span></span><br><span class="line">	<span class="comment">// &#123;&#123;10 10&#125; State 100&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%+v\n%v\n"</span>, label, label)</span><br><span class="line"></span><br><span class="line">	label.Paint()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	button1 := Button&#123;Label&#123;Widget&#123;<span class="number">10</span>, <span class="number">70</span>&#125;, <span class="string">"OK"</span>, <span class="number">10</span>&#125;&#125;</span><br><span class="line">	button2 := NewButton(<span class="number">50</span>, <span class="number">70</span>, <span class="string">"Cancel"</span>)</span><br><span class="line">	listBox := ListBox&#123;Widget&#123;<span class="number">10</span>, <span class="number">40</span>&#125;,</span><br><span class="line">		[]<span class="keyword">string</span>&#123;<span class="string">"AL"</span>, <span class="string">"AK"</span>, <span class="string">"AZ"</span>, <span class="string">"AR"</span>&#125;, <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="comment">//[0xc4200142d0] - Label.Paint("State")</span></span><br><span class="line">	<span class="comment">//[0xc420014300] - ListBox.Paint(["AL" "AK" "AZ" "AR"])</span></span><br><span class="line">	<span class="comment">//[0xc420014330] - Button.Paint("OK")</span></span><br><span class="line">	<span class="comment">//[0xc420014360] - Button.Paint("Cancel")</span></span><br><span class="line">	<span class="keyword">for</span> _, painter := <span class="keyword">range</span> []Painter&#123;label, listBox, button1, button2&#125; &#123; <span class="comment">// ------import----------</span></span><br><span class="line">		painter.Paint()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="comment">//[0xc420014450] - ListBox.Click()</span></span><br><span class="line">	<span class="comment">//[0xc420014480] - Button.Click()</span></span><br><span class="line">	<span class="comment">//[0xc4200144b0] - Button.Click()</span></span><br><span class="line">	<span class="keyword">for</span> _, widget := <span class="keyword">range</span> []<span class="keyword">interface</span>&#123;&#125;&#123;label, listBox, button1, button2&#125; &#123; <span class="comment">// ------import----------</span></span><br><span class="line">		<span class="keyword">if</span> clicker, ok := widget.(Clicker); ok &#123;</span><br><span class="line">			clicker.Click()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ioc" id="IoC">IoC</h5>
<h6 id="step-one" id="step-one">step one</h6>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"errors"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IntSet <span class="keyword">struct</span> &#123;</span><br><span class="line">	data <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewIntSet</span><span class="params">()</span> <span class="title">IntSet</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> IntSet&#123;<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Add</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	set.data[x] = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Delete</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="built_in">delete</span>(set.data, x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Contains</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> set.data[x]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	example2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">example2</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ints := NewUndoableIntSet()</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		ints.Add(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		fmt.Println(i, ints.Contains(i), <span class="string">" "</span>)</span><br><span class="line">		ints.Delete(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := ints.Undo(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UndoableIntSet <span class="keyword">struct</span> &#123; <span class="comment">// Poor style</span></span><br><span class="line">	IntSet    <span class="comment">// Embedding (delegation)</span></span><br><span class="line">	functions []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUndoableIntSet</span><span class="params">()</span> <span class="title">UndoableIntSet</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> UndoableIntSet&#123;NewIntSet(), <span class="literal">nil</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *UndoableIntSet)</span> <span class="title">Add</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123; <span class="comment">// Override</span></span><br><span class="line">	<span class="keyword">if</span> !set.Contains(x) &#123;</span><br><span class="line">		set.data[x] = <span class="literal">true</span></span><br><span class="line">		set.functions = <span class="built_in">append</span>(set.functions, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; set.Delete(x) &#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		set.functions = <span class="built_in">append</span>(set.functions, <span class="literal">nil</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *UndoableIntSet)</span> <span class="title">Delete</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123; <span class="comment">// Override</span></span><br><span class="line">	<span class="keyword">if</span> set.Contains(x) &#123;</span><br><span class="line">		<span class="built_in">delete</span>(set.data, x)</span><br><span class="line">		set.functions = <span class="built_in">append</span>(set.functions, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; set.Add(x) &#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		set.functions = <span class="built_in">append</span>(set.functions, <span class="literal">nil</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *UndoableIntSet)</span> <span class="title">Undo</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(set.functions) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"No functions to undo"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	index := <span class="built_in">len</span>(set.functions) - <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> function := set.functions[index]; function != <span class="literal">nil</span> &#123;</span><br><span class="line">		function()</span><br><span class="line">		set.functions[index] = <span class="literal">nil</span> <span class="comment">// Free closure for garbage collection</span></span><br><span class="line">	&#125;</span><br><span class="line">	set.functions = set.functions[:index]</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="step-two" id="step-two">step two</h6>
<ul>
<li>泛型编程、函数式编程、IoC 等范式:
<ul>
<li>这是不是和最一开始的 C++ 的泛型编程很像？</li>
<li>也和 map、reduce、filter 这样的只关心控制流程，不关心业务逻辑的做法很像？</li>
<li>而且，一开始用一个<strong>UndoableIntSet</strong>来包装<strong>IntSet</strong>类，到反过来在<strong>IntSet</strong>里依赖<strong>Undo</strong>类，这就是控制反转<strong>IoC(inversion of control)</strong></li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"errors"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//example1()</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"------------------------------------\n------------------------------"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//example2()</span></span><br><span class="line">	example3()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">example3</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ints := NewIntSet()</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		ints.Add(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		fmt.Println(i, ints.Contains(i), <span class="string">" "</span>)</span><br><span class="line">		ints.Delete(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := ints.Undo(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Undo []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(undo *Undo)</span> <span class="title">Add</span><span class="params">(function <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">	*undo = <span class="built_in">append</span>(*undo, function)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(undo *Undo)</span> <span class="title">Undo</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	functions := *undo</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(functions) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"No functions to undo"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	index := <span class="built_in">len</span>(functions) - <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> function := functions[index]; function != <span class="literal">nil</span> &#123;</span><br><span class="line">		function()</span><br><span class="line">		functions[index] = <span class="literal">nil</span> <span class="comment">// Free closure for garbage collection</span></span><br><span class="line">	&#125;</span><br><span class="line">	*undo = functions[:index]</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IntSet <span class="keyword">struct</span> &#123;</span><br><span class="line">	data <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span></span><br><span class="line">	undo Undo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewIntSet</span><span class="params">()</span> <span class="title">IntSet</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> IntSet&#123;data: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Add</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> !set.Contains(x) &#123;</span><br><span class="line">		set.data[x] = <span class="literal">true</span></span><br><span class="line">		set.undo.Add(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; set.Delete(x) &#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		set.undo.Add(<span class="literal">nil</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Delete</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> set.Contains(x) &#123;</span><br><span class="line">		<span class="built_in">delete</span>(set.data, x)</span><br><span class="line">		set.undo.Add(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; set.Add(x) &#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		set.undo.Add(<span class="literal">nil</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Undo</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> set.undo.Undo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Contains</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> set.data[x]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">我们再次看到，Go 语言的 Undo 接口把 Undo 的流程给抽象出来，</span></span><br><span class="line"><span class="comment">而要怎么 Undo 的事交给了业务代码来维护（通过注册一个 Undo 的方法）。</span></span><br><span class="line"><span class="comment">这样在 Undo 的时候，就可以回调这个方法来做与业务相关的 Undo 操作了。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="interface-patterns" id="Interface-patterns">Interface patterns</h3>
<h4 id="go-1" id="go-v2">go</h4>
<p><img src="https://raw.githubusercontent.com/zput/myPicLib/master/zput.github.io/20201125111305.png" alt="compared three patterns in golang" /></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Country <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Country)</span> <span class="title">ToString</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Country = "</span> + c.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> City <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c City)</span> <span class="title">ToString</span><span class="params">()</span> <span class="title">string</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"City = "</span> + c.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stringable <span class="keyword">interface</span> &#123;</span><br><span class="line">	ToString() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintStr</span><span class="params">(p Stringable)</span></span> &#123;</span><br><span class="line">	fmt.Println(p.ToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	d1 := Country &#123;<span class="string">"USA"</span>&#125;</span><br><span class="line">	d2 := City&#123;<span class="string">"Los Angeles"</span>&#125;</span><br><span class="line">	PrintStr(d1)</span><br><span class="line">	PrintStr(d2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="example" id="example">example</h6>
<blockquote>
<p>这里的<code>IntSet</code>的String method:<code>func (set *IntSet) String() string {</code>,就是很像前面的<code>interface patterns</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IntSet <span class="keyword">struct</span> &#123;</span><br><span class="line">	data <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewIntSet</span><span class="params">()</span> *<span class="title">IntSet</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;IntSet&#123;<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Add</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	set.data[x] = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Delete</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="built_in">delete</span>(set.data, x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">Contains</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> set.data[x]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Satisfies fmt.Stringer interface</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(set *IntSet)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(set.data) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"&#123;&#125;"</span></span><br><span class="line">	&#125;</span><br><span class="line">	ints := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="built_in">len</span>(set.data))</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> set.data &#123;</span><br><span class="line">		ints = <span class="built_in">append</span>(ints, i) &#125;</span><br><span class="line">	sort.Ints(ints)</span><br><span class="line">	parts := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(ints))</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> ints &#123;</span><br><span class="line">		parts = <span class="built_in">append</span>(parts, fmt.Sprint(i))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"&#123;"</span> + strings.Join(parts, <span class="string">","</span>) + <span class="string">"&#125;"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//An Integer Set with Add(), Delete(), Contains(), String() method</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ints := NewIntSet()</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		ints.Add(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125; &#123;</span><br><span class="line">		fmt.Print(i, ints.Contains(i), <span class="string">" "</span>)</span><br><span class="line">		ints.Delete(i)</span><br><span class="line">		fmt.Println(ints)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="%E9%99%84%E5%BD%95" id="附录">附录</h2>
<p><a href="https://deepu.tech/functional-programming-in-go/">7 Easy functional programming techniques in Go</a></p>
<p><a href="https://medium.com/@geisonfgfg/functional-go-bc116f4c96a4">https://medium.com/@geisonfgfg/functional-go-bc116f4c96a4</a></p>
<p><a href="https://www.packtpub.com/product/learning-functional-programming-in-go/9781787281394">Learning Functional Programming in Go</a></p>
</div><div class="tags"><a href="/tags/%E8%8C%83%E5%BC%8F/"><i class="fa fa-tag"></i>范式</a></div><div class="post-nav"><a class="pre" href="/2020/11/24/%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/">访问者模式</a><a class="next" href="/2020/03/24/tool/kafka/">kafka总结</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/kubernets/">kubernets</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/sql/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/postgres/">postgres</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/">个人成长</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E7%B1%BB/">工具类</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/">服务器编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%A1%E5%BC%8F/">模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%8C%83%E5%BC%8F/">范式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/work/" style="font-size: 15px;">work</a> <a href="/tags/tool/" style="font-size: 15px;">tool</a> <a href="/tags/kubernets/" style="font-size: 15px;">kubernets</a> <a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/postgres/" style="font-size: 15px;">postgres</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/" style="font-size: 15px;">个人成长</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">模式</a> <a href="/tags/%E8%8C%83%E5%BC%8F/" style="font-size: 15px;">范式</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" style="font-size: 15px;">服务器编程</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/gitlab/" style="font-size: 15px;">gitlab</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/08/16/work/aliyun_transcode_video/">利用阿里云进行转码</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/24/%E6%A8%A1%E5%BC%8F/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/">访问者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/20/%E8%8C%83%E5%BC%8F/%E8%8C%83%E5%BC%8F/">三种编程范式</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/24/tool/kafka/">kafka总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/25/tool/gitlab/conclusion_gitlab_ci_cd/">conclusion_gitlab_ci_cd</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/24/tool/postgre/">postgres高级总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/24/tool/MySQL/">mysql高级总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/22/tool/gitlab/the_process_structure_ci_cd_base_on_gitlab/">the_process_structure_ci_cd_base_on_gitlab</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/20/kubernets/telepresence/">telepresence一些使用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/24/tool/cros/">大话跨域</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">xczhao.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>